{# templates/home/snippets/modal_image.html #}
{% set _id   = modal_id or 'promoImageModal' %}
{% set _img  = image_url or '/base/images/popup.jpg' %}
{% set _alt  = alt or 'Promosi' %}
{% set _href = href or None %}  {# abaikan/None kalau mau selalu redirect ke home #}

<div id="{{ _id }}" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="{{ _id }}Label">
  <div class="modal-dialog modal-lg" role="document" style="margin-top:40px;">
    <div class="modal-content" style="border-radius:10px; overflow:hidden; border:0;">
      <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Tutup') }}"
              style="position:absolute; right:10px; top:8px; z-index:2;">
        <span aria-hidden="true">&times;</span>
      </button>

      {% if _href %}<a href="{{ _href }}" target="_blank" rel="noopener">{% endif %}
        <img src="{{ _img }}" alt="{{ _alt }}" class="img-responsive"
             style="display:block; width:100%; height:auto;">
      {% if _href %}</a>{% endif %}
    </div>
  </div>
</div>

<script>
(function(){
  function ready(fn){ if(document.readyState!=='loading'){fn();} else {document.addEventListener('DOMContentLoaded', fn);} }

  ready(function(){
    var el = document.getElementById('{{ _id }}');
    var homeURL = "{{ h.url_for('home.index') }}";

    function goHome(){
      // Langsung arahkan ke halaman utama
      window.location.href = homeURL;
    }

    if (el && typeof jQuery !== 'undefined' && jQuery.fn.modal) {
      var $el = jQuery(el);

      // Tampilkan modal setiap load
      $el.modal({backdrop:true, keyboard:true, show:true});

      // Saat modal sudah tampil, pasang listener global satu kali
      $el.on('shown.bs.modal', function(){
        // Klik di mana saja -> home
        document.addEventListener('click', goHome, {once:true, capture:true});
        // Sentuh layar -> home (untuk mobile)
        document.addEventListener('touchstart', goHome, {once:true, capture:true});
        // Tekan tombol apa pun -> home
        document.addEventListener('keydown', goHome, {once:true, capture:true});
      });

      // Jika modal ditutup tanpa trigger (jarang), bersihkan listener
      $el.on('hidden.bs.modal', function(){
        document.removeEventListener('click', goHome, true);
        document.removeEventListener('touchstart', goHome, true);
        document.removeEventListener('keydown', goHome, true);
      });
    }
  });
})();
</script>
