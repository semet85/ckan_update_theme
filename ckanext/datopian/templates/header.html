{% block header_wrapper %}
<header class="navbar navbar-static-top masthead" role="banner">
  <div class="container">

    <!-- Navbar Header: Brand + Toggler -->
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button"
              data-toggle="collapse" data-target="#main-navigation-toggle"
              aria-controls="main-navigation-toggle" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <hgroup class="{{ g.header_class }}">
        {% if g.site_logo %}
          <a class="navbar-brand logo" href="{{ h.url_for('home.index') }}" aria-label="Beranda {{ g.site_title }}">
            <img src="{{ h.url_for_static_or_external(g.site_logo) }}" alt="{{ g.site_title }}" />
          </a>
        {% else %}
          <a class="navbar-brand" href="{{ h.url_for('home.index') }}">{{ g.site_title }}</a>
        {% endif %}
      </hgroup>
    </div>

    <!-- Navbar Collapse: Main Nav + User -->
    <div class="collapse navbar-collapse" id="main-navigation-toggle" role="navigation" aria-label="Navigasi utama">
      <nav class="section navigation">
        <ul class="nav navbar-nav">
          {{ h.build_nav_main(
              ('dataset.search', _('Dataset')),
              ('organization.index', _('OPD')),
              ('group.index', _('Kategori'))
          ) }}
          <li><a href="/insight">Data Insight</a></li>
          <li><a href="/about">Tentang</a></li>
          <li><a href="https://indah.bps.go.id/standar-data-statistik-nasional" target="_blank" rel="noopener" title="Standar Data Statistik">SDS</a></li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
          {% if c.userobj %}
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-user" aria-hidden="true"></i>
                <span class="username">{{ c.userobj.name }}</span>
                <span class="caret"></span>
              </a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="{{ h.url_for('user.read', id=c.userobj.name) }}"><i class="fa fa-user"></i> Profil Saya</a></li>
                <li><a href="{{ h.url_for('dashboard.index') }}"><i class="fa fa-tachometer"></i> Dashboard</a></li>
                <li><a href="{{ h.url_for('user.edit', id=c.userobj.name) }}"><i class="fa fa-cog"></i> Pengaturan</a></li>
                {% if c.userobj.sysadmin %}
                  <li role="separator" class="divider"></li>
                  <li><a href="{{ h.url_for(controller='admin', action='index') }}"><i class="fa fa-gavel"></i> Sysadmin</a></li>
                {% endif %}
                <li role="separator" class="divider"></li>
                <li><a href="{{ h.url_for('/user/_logout') }}"><i class="fa fa-sign-out"></i> Keluar</a></li>
              </ul>
            </li>
          {% else %}
            <li>{% link_for _('Login'), named_route='user.login' %}</li>
          {% endif %}
        </ul>
      </nav>
    </div>

  </div>
</header>

<!-- Styles -->
<style>
  /* Spacing so content is not hidden under fixed header */
  body { padding-top: 68px; }

  /* Fixed, shrink-on-scroll header */
  header.masthead {
    position: fixed; top: 0; left: 0; right: 0;
    z-index: 1030;
    background: #535353;
    padding: 10px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    transition: background 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease;
  }
  header.masthead.scrolled {
    background: #3a3a3a;
    padding: 6px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  }

  /* Brand image scaling */
  .navbar-brand img { max-height: 42px; transition: max-height 0.3s ease; }
  header.masthead.scrolled .navbar-brand img { max-height: 32px; }

  /* Right side menu aesthetics */
  .navbar-right .username { font-weight: 600; margin-left: 6px; color: #fff; }
  .navbar-right > li > a { color: #f1f1f1; transition: color 0.2s ease; }
  .navbar-right > li > a:hover { color: #ffd966; }

  /* Improve focus visibility for accessibility */
  .navbar a:focus, .dropdown-menu a:focus { outline: 2px dashed #ffd966; outline-offset: 2px; }

  /* Support users who prefer reduced motion */
  @media (prefers-reduced-motion: reduce) {
    header.masthead, .navbar-brand img { transition: none; }
  }
</style>

<!-- Scripts -->
<script>
(function () {
  function onReady(fn){ if(document.readyState !== 'loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }

  onReady(function(){
    // Set title for OPD link
    var opdLink = document.querySelector('ul.nav a[href*="/organization"]');
    if (opdLink && !opdLink.getAttribute('title')) {
      opdLink.setAttribute('title', 'Organisasi Perangkat Daerah');
    }

    // Shrink-on-scroll header (uses rAF for performance)
    var header = document.querySelector('header.masthead');
    var ticking = false;
    function update(){
      if (!header) return;
      header.classList.toggle('scrolled', window.scrollY > 50);
      ticking = false;
    }
    window.addEventListener('scroll', function(){
      if (!ticking) { window.requestAnimationFrame(update); ticking = true; }
    });
    // Initial state in case page loads scrolled
    update();
  });
})();
</script>
{% endblock %}
