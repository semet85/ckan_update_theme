{% block header_wrapper %}
<header class="navbar navbar-static-top masthead">
  <div class="container">
    

    <!-- Logo -->
    <hgroup class="{{ g.header_class }} navbar-left">
      {% if g.site_logo %}
        <a class="logo" href="{{ h.url_for('home.index') }}">
          <img src="{{ h.url_for_static_or_external(g.site_logo) }}" alt="{{ g.site_title }}" />
        </a>
      {% else %}
        <h1><a href="{{ h.url_for('home.index') }}">{{ g.site_title }}</a></h1>
      {% endif %}

      <button data-target="#main-navigation-toggle" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="fa fa-bars"></span>
      </button>
    </hgroup>

    <!-- Navigation -->
    <div class="collapse navbar-collapse" id="main-navigation-toggle">
    <nav class="section navigation">
        <ul class="nav nav-pills">
            {{ h.build_nav_main(
                ('dataset.search', _('Dataset')),
                ('organization.index', _('OPD')),
                ('group.index', _('Kategori')),
                ('ckanet_insight.insights_home', _('Insights'))
            ) }}
            <li><a href="/about">Tentang</a></li>
            <li><a href="https://indah.bps.go.id/standar-data-statistik-nasional" target="_blank" title="Standar Data Statistik">SDS</a></li>
        
              <ul class="nav navbar-nav">
                {% if c.userobj %}
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-user" aria-hidden="true"></i>
                        <span class="username">{{ c.userobj.name }}</span>
                        <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="{{ h.url_for('user.read', id=c.userobj.name) }}"><i class="fa fa-user"></i> Profil Saya</a></li>
                            <li><a href="{{ h.url_for('dashboard.index') }}"><i class="fa fa-tachometer"></i> Dashboard</a></li>
                            {% if c.userobj.sysadmin %}
                            <li><a href="{{ h.url_for('user.edit', id=c.userobj.name) }}"><i class="fa fa-cog"></i> Pengaturan</a></li>     
                            <li><a href="{{ h.url_for(controller='admin', action='index') }}"><i class="fa fa-gavel"></i> Sysadmin</a></li>
                            {% endif %}
                            <li role="separator" class="divider"></li>
                            <li><a href="{{ h.url_for('/user/_logout') }}"><i class="fa fa-sign-out"></i> Keluar</a></li>
                        </ul>
                    </li>
              </ul>    
                
         </ul>
                            {% else %}
                            <li>{% link_for _('Login'), named_route='user.login' %}</li>
                {% endif %}
        
    </nav>
</div>
  </div>
</header>

<!-- ðŸ”¹ Inline CSS + JS -->
<style>
  :root{
    --masthead-h: 60px;      /* fallback kalau JS gagal */
    --page-top-gap: 10px;    /* jarak kecil antara header & konten */
  }

  /* header tetap fixed */
  header.masthead{
    position: fixed; top:0; left:0; width:100%;
    z-index:1030; transition: all .3s ease;
    padding:8px 0; background:#535353; box-shadow:0 2px 8px rgba(0,0,0,.2);
  }
  header.masthead.scrolled{ background:#3c3c3c; padding:5px 0; box-shadow:0 3px 12px rgba(0,0,0,.3); }
  header.masthead img{ max-height:40px; transition:max-height .3s ease; }
  header.masthead.scrolled img{ max-height:33px; }

  /* ðŸ‘‰ padding-top body mengikuti tinggi header + sedikit gap */
  body{ padding-top: calc(var(--masthead-h) + var(--page-top-gap)); }

  /* rapikan tampilan user menu */
  .navbar-right .username{ font-weight:500; margin-left:6px; color:#fff; }
  .navbar-right a{ color:#f5f5f5; transition:color .2s; }
  .navbar-right a:hover{ color:#ffd966; }

  /* ðŸ”¹ KECILKAN margin judul & toolbar khusus halaman dataset */
  /* CKAN memberi class controller & action ke <body> */
  body[class*="controller-package"] .page-heading{ margin-top: 4px !important; }
  body[class*="controller-package"] .toolbar{ margin-top: 6px !important; }

  /* opsi tambahan: rapikan container paling atas jika tema memberi gap besar */
  body[class*="controller-package"] .wrapper, 
  body[class*="controller-package"] .content{ padding-top: 0 !important; }
</style>


<script>
  function setMastheadHeight(){
    var h = document.querySelector('header.masthead');
    if(!h) return;
    var height = Math.ceil(h.getBoundingClientRect().height);
    document.documentElement.style.setProperty('--masthead-h', height + 'px');
  }
  document.addEventListener('DOMContentLoaded', setMastheadHeight);
  window.addEventListener('load', setMastheadHeight);
  window.addEventListener('resize', setMastheadHeight);
  window.addEventListener('scroll', setMastheadHeight);

  // Tooltip kecil untuk OPD
  document.addEventListener('DOMContentLoaded', function(){
    var opdLink = document.querySelector('ul.nav a[href*="/organization"]');
    if(opdLink){ opdLink.title = 'Organisasi Perangkat Daerah'; }
  });

  // efek scroll: header mengecil
  window.addEventListener('scroll', function(){
    var header = document.querySelector('header.masthead');
    if(header){ header.classList.toggle('scrolled', window.scrollY > 50); }
  });
</script>

{% endblock %}
